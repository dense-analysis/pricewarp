\copy (select id as user_id, username, password as password_hash, to_char(now() at time zone 'UTC', 'YYYY-MM-DD HH24:MI:SS.US') as created_at, to_char(now() at time zone 'UTC', 'YYYY-MM-DD HH24:MI:SS.US') as updated_at, 1 as is_active from crypto_user order by id) to 'crypto_users.csv' with (format csv, header true)
\copy (select ticker, name, to_char(now() at time zone 'UTC', 'YYYY-MM-DD HH24:MI:SS.US') as updated_at from crypto_currency order by ticker) to 'crypto_currencies.csv' with (format csv, header true)
\copy (select price.time, from_currency.ticker as from_currency_ticker, from_currency.name as from_currency_name, to_currency.ticker as to_currency_ticker, to_currency.name as to_currency_name, price.value from crypto_price as price inner join crypto_currency as from_currency on from_currency.id = price."from" inner join crypto_currency as to_currency on to_currency.id = price."to" order by price.time) to 'crypto_currency_prices.csv' with (format csv, header true)
\copy (select alert.id as alert_id, alert.user_id, crypto_user.username, from_currency.ticker as from_currency_ticker, from_currency.name as from_currency_name, to_currency.ticker as to_currency_ticker, to_currency.name as to_currency_name, alert.value, case when alert.above then 1 else 0 end as above, to_char(alert.time, 'YYYY-MM-DD HH24:MI:SS.US') as alert_time, case when alert.sent then 1 else 0 end as sent, to_char(now() at time zone 'UTC', 'YYYY-MM-DD HH24:MI:SS.US') as updated_at, 0 as is_deleted from crypto_alert as alert inner join crypto_user on crypto_user.id = alert.user_id inner join crypto_currency as from_currency on from_currency.id = alert."from" inner join crypto_currency as to_currency on to_currency.id = alert."to" order by alert.time) to 'crypto_alert.csv' with (format csv, header true)
\copy (select portfolio.user_id, crypto_user.username, currency.ticker as currency_ticker, currency.name as currency_name, portfolio.cash, to_char(now() at time zone 'UTC', 'YYYY-MM-DD HH24:MI:SS.US') as updated_at, 0 as is_deleted from crypto_portfolio as portfolio inner join crypto_user on crypto_user.id = portfolio.user_id inner join crypto_currency as currency on currency.id = portfolio.currency_id order by portfolio.user_id, currency.ticker) to 'crypto_portfolio.csv' with (format csv, header true)
\copy (select asset.user_id, crypto_user.username, currency.ticker as currency_ticker, currency.name as currency_name, asset.purchased, asset.amount, to_char(now() at time zone 'UTC', 'YYYY-MM-DD HH24:MI:SS.US') as updated_at, 0 as is_deleted from crypto_asset as asset inner join crypto_user on crypto_user.id = asset.user_id inner join crypto_currency as currency on currency.id = asset.currency_id order by asset.user_id, currency.ticker) to 'crypto_asset.csv' with (format csv, header true)
