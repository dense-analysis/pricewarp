{{define "main"}}
  {{$currency := .Portfolio.Currency}}
  <form class="line-wrap-form" method="post">
    <div class="field-wrapper">
      Use
      <select name="currency">
        {{range .ToCurrencyList}}
          <option value="{{.ID}}"{{if eq .ID $currency.ID}} selected{{end}}>{{.Name}}</option>
        {{end}}
      </select>
      as currency.
    </div>
    <div class="field-wrapper">
      With
      <input class="price" type="text" pattern="^\d*(\.\d*)?$" placeholder="0.00" name="cash"{{if .Portfolio.Cash.IsPositive}} value="{{.Portfolio.Cash.String}}"{{end}}>
      cash available.
    </div>
    <div class="field-wrapper">
      <button>Update Currency</button>
    </div>
  </form>
  {{if .Portfolio.Currency.ID}}
    <!-- TODO: Use JS to set the form action -->
    <form class="line-wrap-form" method="post" data-format-action action="/portfolio/{ticker}/buy">
      <div class="field-wrapper">
        Buy
        <input required name="crypto" class="price" type="text" pattern="^\d*(\.\d*)?$" placeholder="0.00">
        <select data-format-action="ticker">
          {{range .FromCurrencyList}}
            <option value="{{.Ticker}}">{{.Name}}</option>
          {{end}}
        </select>
        for
        <input required name="fiat" class="price" type="text" pattern="^\d*(\.\d*)?$" placeholder="0.00">
        {{.Portfolio.Currency.Ticker}}
      </div>
      <div class="field-wrapper">
        <button>Buy</button>
      </div>
    </form>
    <form class="line-wrap-form" method="post" data-format-action action="/portfolio/{ticker}/sell">
      <div class="field-wrapper">
        Sell
        <input required name="crypto" class="price" type="text" pattern="^\d*(\.\d*)?$" placeholder="0.00">
        <select data-format-action="ticker">
          {{range .FromCurrencyList}}
            <option value="{{.Ticker}}">{{.Name}}</option>
          {{end}}
        </select>
        for
        <input required name="fiat" class="price" type="text" pattern="^\d*(\.\d*)?$" placeholder="0.00">
        {{.Portfolio.Currency.Ticker}}
      </div>
      <div class="field-wrapper">
        <button>Sell</button>
      </div>
    </form>
    <table class="portfolio-summary-table">
      <tbody>
        <tr>
          <th>Purchased</th>
          <td>{{.TotalPurchased.StringFixed 2}}</td>
        </tr>
        <tr>
          <th>Total</th>
          <td>{{.TotalValue.StringFixed 2}}</td>
        </tr>
        <tr>
          <th>Profit</th>
          <td>{{.TotalProfit.StringFixed 2}}</td>
        </tr>
        <tr>
          <th>Performance</th>
          <td>{{.AveragePerformance.StringFixed 2}}%</td>
        </tr>
      </tbody>
    </table>
    <table class="asset-table">
      <thead>
        <tr>
          <th>Currency</th>
          <th>Portfolio %</th>
          <th>Value</th>
          <th>Performance</th>
        </tr>
      </thead>
      <tbody>
        {{range .AssetList}}
          <tr>
            <td><a href="/portfolio/{{.Currency.Ticker}}">{{.Currency.Name}}</a></td>
            <td>{{.ShareOfPortfolio.StringFixed 2}}%</td>
            <td>{{.Value.StringFixed 2}} {{$currency.Ticker}}</td>
            <td>{{.Performance.StringFixed 2}}%</td>
          </tr>
        {{end}}
      </tbody>
    </table>
  {{end}}
{{end}}
